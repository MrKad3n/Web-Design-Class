<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Kaden's Dungeon Game</title>
        <link rel="stylesheet" type="text/css" href="style.css">
        <link rel="stylesheet" href="https://www.w3schools.com/w3css/5/w3.css">
        <link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-blue.css">
        <style>
            .settings-button {
                position: absolute;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #0f3460 0%, #16213e 100%);
                color: #fff;
                padding: 12px 24px;
                border: 2px solid #e94560;
                border-radius: 8px;
                cursor: pointer;
                font-size: 1.1em;
                font-weight: bold;
                transition: all 0.3s;
            }

            .settings-button:hover {
                background: linear-gradient(135deg, #e94560 0%, #ff6b88 100%);
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(233, 69, 96, 0.4);
            }

            .settings-modal {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.85);
                display: none;
                align-items: center;
                justify-content: center;
                z-index: 9999;
            }

            .settings-modal.active {
                display: flex;
            }

            .settings-content {
                background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
                border: 3px solid #e94560;
                border-radius: 15px;
                padding: 40px;
                max-width: 500px;
                width: 90%;
                position: relative;
            }

            .settings-close {
                position: absolute;
                top: 15px;
                right: 15px;
                background: #e94560;
                color: #fff;
                border: none;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                font-size: 1.5em;
                cursor: pointer;
                font-weight: bold;
            }

            .settings-close:hover {
                background: #ff6b88;
            }

            .settings-title {
                font-size: 2.5em;
                color: #e94560;
                text-shadow: 0 0 10px rgba(233, 69, 96, 0.5);
                text-align: center;
                margin-bottom: 30px;
            }

            .settings-option {
                background: rgba(15, 52, 96, 0.3);
                border: 2px solid #0f3460;
                border-radius: 10px;
                padding: 20px;
                margin-bottom: 15px;
                cursor: pointer;
                transition: all 0.3s;
            }

            .settings-option:hover {
                border-color: #e94560;
                transform: translateX(5px);
                box-shadow: 0 5px 15px rgba(233, 69, 96, 0.3);
            }

            .option-title {
                font-size: 1.4em;
                font-weight: bold;
                color: #fff;
                margin-bottom: 8px;
            }

            .option-description {
                color: #aaa;
                font-size: 0.95em;
            }

            .danger-option {
                border-color: #ff0000;
            }

            .danger-option:hover {
                border-color: #ff4444;
                box-shadow: 0 5px 15px rgba(255, 0, 0, 0.3);
            }

            .danger-option .option-title {
                color: #ff4444;
            }
        </style>
    </head>
<body id="home">
    <button class="settings-button" onclick="openSettings()">‚öôÔ∏è Settings</button>

    <div class="w3-container">
          
          <div class="w3-container w3-left" style="width:50%">

            <h1 id="esc">Kaden's Dungeon Game</h1>

        </div>
        <div class="w3-row">
            <div class="w3-col m6">
                
                <h2 class="glow">WELCOME</h2>
                <img src="Assests/player.png" alt="img" style="height:40%">
                <h3>LVL: #</h3>
            </div>
        

            <div class="w3-col m4 w3-block w3-center">
                <br><br>
                <a href="select.html"><button class="w3-lime w3-text-green select-button w3-centered">Play</button></a>
                <br><br><br>
                <a href="upgrade.html"><button class="w3-red w3-text-orange select-button w3-centered">Upgrade</button></a>
                <br><br><br>
                <a href="inventory.html"><button class="w3-blue-grey w3-text-red select-button w3-centered">Inventory</button></a>
                <br><br><br>
                <a href="index.html"><button class="w3-purple w3-text-white select-button w3-centered">Collection</button></a>
            </div>

        </div>
    </div>

    <!-- Settings Modal -->
    <div class="settings-modal" id="settings-modal">
        <div class="settings-content">
            <button class="settings-close" onclick="closeSettings()">√ó</button>
            <h2 class="settings-title">‚öôÔ∏è Settings</h2>

            <div class="settings-option" onclick="fillAllIndexes()">
                <div class="option-title">üìã Fill All Indexes</div>
                <div class="option-description">
                    Instantly unlock all items and enemies in your collection index without having to discover them.
                </div>
            </div>
            
            <div class="settings-option" onclick="toggleMusic()">
                <div class="option-title">üéµ Toggle Music</div>
                <div class="option-description" id="music-status">
                    Music is currently enabled. Click to disable.
                </div>
            </div>

            <div class="settings-option danger-option" onclick="completelyRestart()">
                <div class="option-title">üîÑ Complete Restart</div>
                <div class="option-description">
                    Reset ALL progress including inventory, enchantments, map progression, and collection index. This action cannot be undone.
                </div>
            </div>
        </div>
    </div>
    
    <!-- Music Preference Modal -->
    <div class="settings-modal" id="music-preference-modal" style="display: none;">
        <div class="settings-content" style="max-width: 500px;">
            <h2 class="settings-title">üéµ Music Preference</h2>
            <p style="color: #fff; font-size: 1.1em; text-align: center; margin: 20px 0;">
                Would you like to enable background music while playing?
            </p>
            <div style="display: flex; gap: 20px; justify-content: center; margin-top: 30px;">
                <button class="settings-option" style="width: 150px; cursor: pointer;" onclick="setMusicPreference(true)">
                    <div class="option-title">‚úÖ Yes</div>
                    <div class="option-description">Enable music</div>
                </button>
                <button class="settings-option" style="width: 150px; cursor: pointer;" onclick="setMusicPreference(false)">
                    <div class="option-title">‚ùå No</div>
                    <div class="option-description">Keep it quiet</div>
                </button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script src="index.js"></script>
    <script src="enemy-index.js"></script>
    <script>
        // Music system
        let lobbyMusic = null;
        
        function isMusicEnabled() {
            const preference = localStorage.getItem('musicEnabled');
            return preference === 'true';
        }
        
        function setMusicPreference(enabled) {
            localStorage.setItem('musicEnabled', enabled.toString());
            localStorage.setItem('musicPreferenceSet', 'true');
            document.getElementById('music-preference-modal').style.display = 'none';
            
            if (enabled) {
                playLobbyMusic();
            }
            
            updateMusicStatusText();
        }
        
        function playLobbyMusic() {
            if (!isMusicEnabled()) return;
            
            if (lobbyMusic) {
                lobbyMusic.pause();
                lobbyMusic = null;
            }
            
            lobbyMusic = new Audio('audio/background/mainTheme.wav');
            lobbyMusic.loop = true;
            lobbyMusic.volume = 0.5;
            
            // Restore playback position from localStorage
            const savedPosition = parseFloat(localStorage.getItem('mainTheme_position')) || 0;
            lobbyMusic.currentTime = savedPosition;
            
            // Save position periodically
            lobbyMusic.addEventListener('timeupdate', () => {
                localStorage.setItem('mainTheme_position', lobbyMusic.currentTime.toString());
            });
            
            // Try to play, handling autoplay restrictions
            const playPromise = lobbyMusic.play();
            if (playPromise !== undefined) {
                playPromise.then(() => {
                    console.log('Lobby music playing successfully');
                }).catch(err => {
                    console.log('Autoplay prevented, waiting for user interaction:', err);
                    // Wait for any user interaction to start music
                    const startMusic = () => {
                        if (lobbyMusic && isMusicEnabled()) {
                            lobbyMusic.play().then(() => {
                                console.log('Lobby music started after user interaction');
                            }).catch(e => console.error('Failed to play music:', e));
                            document.removeEventListener('click', startMusic);
                            document.removeEventListener('keydown', startMusic);
                        }
                    };
                    document.addEventListener('click', startMusic);
                    document.addEventListener('keydown', startMusic);
                });
            }
        }
        
        function toggleMusic() {
            const currentState = isMusicEnabled();
            const newState = !currentState;
            localStorage.setItem('musicEnabled', newState.toString());
            
            if (newState) {
                playLobbyMusic();
            } else {
                if (lobbyMusic) {
                    lobbyMusic.pause();
                    lobbyMusic = null;
                }
            }
            
            updateMusicStatusText();
        }
        
        function updateMusicStatusText() {
            const statusEl = document.getElementById('music-status');
            if (statusEl) {
                if (isMusicEnabled()) {
                    statusEl.textContent = 'Music is currently enabled. Click to disable.';
                } else {
                    statusEl.textContent = 'Music is currently disabled. Click to enable.';
                }
            }
        }
        
        // Check if this is first visit
        window.addEventListener('DOMContentLoaded', () => {
            const preferenceSet = localStorage.getItem('musicPreferenceSet');
            
            if (!preferenceSet) {
                // First visit - show music preference modal
                document.getElementById('music-preference-modal').style.display = 'flex';
            } else if (isMusicEnabled()) {
                // Returning user with music enabled
                playLobbyMusic();
            }
            
            updateMusicStatusText();
            
            // Add select sound to all buttons and clickable elements
            document.addEventListener('click', (e) => {
                const target = e.target;
                if (target.tagName === 'BUTTON' || target.classList.contains('select-button') || 
                    target.classList.contains('settings-option') || target.tagName === 'A') {
                    const musicEnabled = localStorage.getItem('musicEnabled') === 'true';
                    if (musicEnabled) {
                        const selectSound = new Audio('audio/soundEffects/select.wav');
                        selectSound.volume = 0.3;
                        selectSound.play().catch(err => {});
                    }
                }
            });
        });
        
        function openSettings() {
            document.getElementById('settings-modal').classList.add('active');
        }

        function closeSettings() {
            document.getElementById('settings-modal').classList.remove('active');
        }

        function fillAllIndexes() {
            if (!confirm('Fill all collection indexes?\n\nThis will unlock all items and enemies in your collection.')) {
                return;
            }
            
            try {
                // Fill item index
                if (typeof ITEM_TABLE !== 'undefined') {
                    for (const itemName in ITEM_TABLE) {
                        if (typeof registerItemCollected === 'function') {
                            registerItemCollected(itemName);
                        }
                    }
                }
                
                // Fill enemy index
                if (typeof ENEMY_BASE_STATS !== 'undefined') {
                    for (const enemyKey in ENEMY_BASE_STATS) {
                        if (typeof registerEnemyDefeated === 'function') {
                            registerEnemyDefeated(enemyKey);
                        }
                    }
                }
                
                alert('‚úÖ All indexes have been filled!\n\nCheck your Collection page to see all items and enemies.');
                closeSettings();
                
                // Refresh index pages if their reload functions exist
                if (typeof loadItemIndex === 'function') {
                    loadItemIndex();
                }
                if (typeof renderEnemyIndex === 'function') {
                    renderEnemyIndex();
                }
            } catch (e) {
                console.error('Error filling indexes:', e);
                alert('An error occurred while filling indexes. Please check the console.');
            }
        }

        function completelyRestart() {
            const confirmation = confirm('‚ö†Ô∏è WARNING ‚ö†Ô∏è\n\nThis will completely reset ALL your progress including:\n\n‚Ä¢ All inventory items\n‚Ä¢ All enchantments\n‚Ä¢ Map progression (both Normal and Hard mode)\n‚Ä¢ Collection index (items and enemies)\n‚Ä¢ Party stats and equipment\n‚Ä¢ Attack inventory\n\nThis action CANNOT be undone!\n\nAre you absolutely sure you want to continue?');
            
            if (!confirmation) return;

            const doubleConfirm = confirm('This is your LAST chance to cancel.\n\nType YES in your mind and click OK to proceed with complete reset.');
            
            if (!doubleConfirm) return;

            try {
                // Clear all localStorage data FIRST
                localStorage.clear(); // Clear everything to ensure complete reset
                
                // Now reload the page to get fresh PARTY_STATS, INVENTORY, etc. from script.js defaults
                // Then on the reloaded page, we'll give the sticks
                
                // Set a flag so we know to give sticks on next load
                localStorage.setItem('needsStarterSticks', 'true');
                
                alert('‚úÖ All progress has been completely reset!\n\nThe page will now reload and give you starter items.');
                
                // Force reload from server (not cache) to get fresh state
                window.location.href = window.location.href.split('?')[0];
            } catch (e) {
                console.error('Error during reset:', e);
                alert('An error occurred during reset. Please try clearing your browser cache manually.');
            }
        }

        // Close modal when clicking outside
        document.addEventListener('click', (e) => {
            const modal = document.getElementById('settings-modal');
            if (e.target === modal) {
                closeSettings();
            }
        });
    </script>
</body>
    <footer>
        Kaden Cruts - 2025
    </footer>
</html>
</html>